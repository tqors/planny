{% extends 'layouts/base.html' %}

{% block title %} Kanban Board {% endblock title %}

<!-- Specific CSS goes HERE -->
{% block stylesheets %}
<link rel="stylesheet" href="/static/assets/css/kanban.css">
{% endblock stylesheets %}

{% block content %}
    <!-- Header -->
    <div class="header bg-gradient-primary pb-8 pt-5 pt-md-8">
      <div class="container-fluid">
        <div class="header-body">
          <div class="row">
            <div class="col-lg-12 col-md-12">
              <h1 class="display-2 text-white">Dashboard</h1>
              <p class="text-white mt-0 mb-0">Kanban Board - Manage your tasks with ease</p>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="container-fluid mt--7">
      <div class="row">
        <div class="col">
          <div class="card shadow">
            <div class="card-header bg-transparent">
              <div class="kanban-top-bar">
                <div>
                  <h3 class="mb-0" style="display: inline-block; margin-right: 20px;">Project Tasks</h3>
                  <select id="projectFilter" style="padding: 8px 12px; border: 1px solid #ddd; border-radius: 4px; font-size: 14px;">
                    <option value="">-- All Projects --</option>
                  </select>
                </div>
                <button class="btn-new-task" onclick="openTaskModal()">+ New Task</button>
              </div>
            </div>
            <div class="card-body">
              <div class="kanban-container" id="kanbanContainer">
                <!-- Kanban columns will be generated here by JavaScript -->
              </div>
            </div>
          </div>
        </div>
      </div>

      {% include "includes/footer.html" %}
    </div>

    <!-- Task Modal -->
    <div class="overlay" id="taskOverlay">
      <div class="modal-content">
        <div class="modal-header">
          Create New Task
        </div>
        <form id="taskForm">
          <div class="form-group">
            <label for="taskTitle">Task Title *</label>
            <input type="text" id="taskTitle" name="taskTitle" placeholder="Enter task title" required>
            <span class="error-message" id="titleError"></span>
          </div>

          <div class="form-group">
            <label for="taskDescription">Task Description</label>
            <textarea id="taskDescription" name="taskDescription" placeholder="Enter task description"></textarea>
            <span class="error-message" id="descError"></span>
          </div>

          <div class="form-group">
            <label for="taskStatus">Status *</label>
            <select id="taskStatus" name="taskStatus" required>
              <option value="">-- Select Status --</option>
              <option value="1">To-Do</option>
              <option value="2">In Progress</option>
              <option value="3">Bug Report</option>
              <option value="4">Testing</option>
              <option value="5">Complete</option>
            </select>
            <span class="error-message" id="statusError"></span>
          </div>

          <div class="form-group">
            <label for="taskPriority">Priority</label>
            <select id="taskPriority" name="taskPriority">
              <option value="">-- Select Priority --</option>
              <option value="High">High</option>
              <option value="Medium">Medium</option>
              <option value="Low">Low</option>
            </select>
          </div>

          <div class="form-group">
            <label for="taskDueDate">Due Date</label>
            <input type="date" id="taskDueDate" name="taskDueDate">
            <span class="error-message" id="dueDateError"></span>
          </div>

          <div class="form-group">
            <label for="taskAssignedTo">Assigned To</label>
            <select id="taskAssignedTo" name="taskAssignedTo" id="assignedToSelect">
              <option value="">-- Select Developer --</option>
              <!-- Options will be populated by JavaScript -->
            </select>
            <span class="error-message" id="assignedError"></span>
          </div>

          <div class="form-group">
            <label for="taskProject">Project *</label>
            <select id="taskProject" name="taskProject" required>
              <option value="">-- Select Project --</option>
              <!-- Options will be populated by JavaScript -->
            </select>
            <span class="error-message" id="projectError"></span>
          </div>

          <div class="loading" id="formLoading">
            <div class="spinner"></div>
            <p>Saving task...</p>
          </div>

          <div class="success-message" id="successMessage">Task created successfully!</div>

          <div class="modal-buttons">
            <button type="button" class="btn-cancel" onclick="closeTaskModal()">Cancel</button>
            <button type="submit" class="btn-save">Create Task</button>
          </div>
        </form>
      </div>
    </div>

    <!-- Edit Task Modal -->
    <div class="overlay" id="editTaskOverlay">
      <div class="modal-content">
        <div class="modal-header">
          Edit Task
        </div>
        <form id="editTaskForm">
          <input type="hidden" id="editTaskId" name="editTaskId">
          
          <div class="form-group">
            <label for="editTaskTitle">Task Title *</label>
            <input type="text" id="editTaskTitle" name="editTaskTitle" placeholder="Enter task title" required>
            <span class="error-message" id="editTitleError"></span>
          </div>

          <div class="form-group">
            <label for="editTaskDescription">Task Description</label>
            <textarea id="editTaskDescription" name="editTaskDescription" placeholder="Enter task description"></textarea>
            <span class="error-message" id="editDescError"></span>
          </div>

          <div class="form-group">
            <label for="editTaskStatus">Status *</label>
            <select id="editTaskStatus" name="editTaskStatus" required>
              <option value="">-- Select Status --</option>
              <option value="1">To-Do</option>
              <option value="2">In Progress</option>
              <option value="3">Bug Report</option>
              <option value="4">Testing</option>
              <option value="5">Complete</option>
            </select>
            <span class="error-message" id="editStatusError"></span>
          </div>

          <div class="form-group">
            <label for="editTaskPriority">Priority</label>
            <select id="editTaskPriority" name="editTaskPriority">
              <option value="">-- Select Priority --</option>
              <option value="High">High</option>
              <option value="Medium">Medium</option>
              <option value="Low">Low</option>
            </select>
          </div>

          <div class="form-group">
            <label for="editTaskDueDate">Due Date</label>
            <input type="date" id="editTaskDueDate" name="editTaskDueDate">
            <span class="error-message" id="editDueDateError"></span>
          </div>

          <div class="form-group">
            <label for="editTaskAssignedTo">Assigned To</label>
            <select id="editTaskAssignedTo" name="editTaskAssignedTo">
              <option value="">-- Select Developer --</option>
              <!-- Options will be populated by JavaScript -->
            </select>
            <span class="error-message" id="editAssignedError"></span>
          </div>

          <div class="form-group">
            <label for="editTaskProject">Project *</label>
            <select id="editTaskProject" name="editTaskProject" required>
              <option value="">-- Select Project --</option>
              <!-- Options will be populated by JavaScript -->
            </select>
            <span class="error-message" id="editProjectError"></span>
          </div>

          <div class="loading" id="editFormLoading">
            <div class="spinner"></div>
            <p>Saving changes...</p>
          </div>

          <div class="success-message" id="editSuccessMessage">Task updated successfully!</div>

          <div class="modal-buttons">
            <button type="button" class="btn-cancel" onclick="closeEditTaskModal()">Cancel</button>
            <button type="submit" class="btn-save">Save Changes</button>
          </div>
        </form>
      </div>
    </div>

{% endblock content %}

<!-- Specific JS goes HERE --> 
{% block javascripts %}

<script src="/static/assets/vendor/clipboard/dist/clipboard.min.js"></script>
<script src="/static/assets/js/kanban.js"></script>

{% endblock javascripts %}
